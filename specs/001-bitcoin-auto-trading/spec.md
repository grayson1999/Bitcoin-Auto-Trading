# Feature Specification: Bitcoin Auto-Trading System

**Feature Branch**: `001-bitcoin-auto-trading`
**Created**: 2026-01-11
**Status**: Draft
**Input**: User description: "Upbit 거래소와 ChatGPT API를 연동하여 비트코인 자동 매매를 수행하는 시스템"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 자동 매매 실행 (Priority: P1)

트레이더로서, 24시간 시장을 모니터링하지 않고도 AI 기반 따라 비트코인을 자동으로 분석에 매수/매도할 수 있어야 합니다. 이를 통해 시장 기회를 놓치지 않고 감정적 의사결정을 배제할 수 있습니다.

**Why this priority**: 이 시스템의 핵심 가치 제안입니다. AI 기반 자동 매매 없이는 시스템 존재 이유가 없습니다.

**Independent Test**: Upbit 테스트넷 또는 소액으로 실제 매매 신호 생성 및 주문 실행을 검증할 수 있습니다. AI가 "Buy" 신호를 생성하면 실제로 주문이 체결되는지 확인합니다.

**Acceptance Scenarios**:

1. **Given** 시스템이 실행 중이고 Upbit 계정이 연결된 상태, **When** AI가 "Buy" 신호를 생성, **Then** 시스템이 리스크 규칙 내에서 자동으로 매수 주문을 실행합니다.
2. **Given** 보유 포지션이 있는 상태, **When** AI가 "Sell" 신호를 생성, **Then** 시스템이 자동으로 매도 주문을 실행합니다.
3. **Given** AI가 "Hold" 신호를 생성, **When** 신호가 처리됨, **Then** 시스템이 현재 포지션을 유지하고 새 주문을 생성하지 않습니다.

---

### User Story 2 - 리스크 관리 및 자본 보호 (Priority: P1)

트레이더로서, 시스템이 사전 정의된 리스크 규칙을 자동으로 적용하여 과도한 손실로부터 자본을 보호해야 합니다. 예상치 못한 시장 상황에서도 자본이 안전하게 보호되어야 합니다.

**Why this priority**: 자본 보호는 자동 매매와 동등하게 중요합니다. 리스크 관리 없는 자동 매매는 오히려 위험합니다.

**Independent Test**: 손실 시뮬레이션을 통해 손절 규칙과 시스템 정지 기능이 정상 작동하는지 검증할 수 있습니다.

**Acceptance Scenarios**:

1. **Given** 개별 거래 손실이 3~5%에 도달, **When** 손절 조건 충족, **Then** 시스템이 즉시 해당 포지션을 자동 청산합니다.
2. **Given** 일일 누적 손실이 한도를 초과, **When** 손실 한도 감지, **Then** 시스템이 자동으로 거래를 중단하고 관리자에게 알림을 전송합니다.
3. **Given** 매매 신호가 발생, **When** 주문 금액이 전체 자본의 2%를 초과, **Then** 시스템이 해당 주문을 거부하고 로그를 기록합니다.

---

### User Story 3 - 실시간 시장 데이터 수집 (Priority: P1)

시스템으로서, Upbit에서 실시간 비트코인 가격, 거래량, 체결 정보를 수집하여 AI 분석의 기반을 제공해야 합니다.

**Why this priority**: 정확한 시장 데이터 없이는 AI 분석과 매매 결정이 불가능합니다. 시스템의 근본적인 입력 데이터입니다.

**Independent Test**: 데이터 수집 모듈만 실행하여 Upbit에서 실시간 데이터가 정상적으로 수신되고 저장되는지 확인할 수 있습니다.

**Acceptance Scenarios**:

1. **Given** 시스템이 Upbit에 연결된 상태, **When** 시장이 운영 중, **Then** 시스템이 1초 간격으로 가격 및 거래량 데이터를 수집합니다.
2. **Given** 네트워크 연결 문제 발생, **When** 데이터 수집 실패, **Then** 시스템이 자동으로 재연결을 시도하고 오류를 기록합니다.
3. **Given** 수집된 데이터, **When** 데이터 저장 요청, **Then** 시스템이 향후 백테스팅을 위해 데이터를 영구 저장합니다.

---

### User Story 4 - AI 기반 매매 신호 생성 (Priority: P1)

시스템으로서, 수집된 시장 데이터를 AI에 제공하여 매수/보유/매도 신호와 신뢰도 점수를 생성해야 합니다.

**Why this priority**: AI 신호 생성은 시스템의 핵심 지능입니다. 데이터와 매매 실행을 연결하는 두뇌 역할입니다.

**Independent Test**: 과거 시장 데이터를 AI에 입력하여 신호가 올바른 형식(Buy/Hold/Sell + 신뢰도)으로 반환되는지 확인할 수 있습니다.

**Acceptance Scenarios**:

1. **Given** 정제된 시장 데이터가 준비됨, **When** AI 분석 요청, **Then** 시스템이 "Buy", "Hold", 또는 "Sell" 신호를 신뢰도 점수(0~1)와 함께 반환합니다.
2. **Given** AI API 요청, **When** 분석 완료, **Then** 시스템이 5초 이내에 응답을 수신합니다.
3. **Given** AI가 신호를 생성, **When** 신호 저장 요청, **Then** 시스템이 신호, 신뢰도, 분석 근거를 기록합니다.

---

### User Story 5 - 거래 모니터링 대시보드 (Priority: P2)

트레이더로서, 웹 대시보드를 통해 현재 포지션, 거래 내역, 수익률, AI 신호를 실시간으로 모니터링할 수 있어야 합니다.

**Why this priority**: 모니터링은 중요하지만 핵심 거래 기능 이후의 부가 기능입니다. 초기에는 로그로 대체 가능합니다.

**Independent Test**: 대시보드 페이지에 접속하여 현재 상태와 거래 내역이 표시되는지 확인할 수 있습니다.

**Acceptance Scenarios**:

1. **Given** 시스템이 운영 중, **When** 사용자가 대시보드에 접속, **Then** 현재 비트코인 가격, 보유 포지션, 계좌 잔고가 표시됩니다.
2. **Given** 새로운 거래가 실행됨, **When** 대시보드 화면, **Then** 거래 정보가 실시간으로 업데이트됩니다.
3. **Given** 대시보드 접속, **When** 거래 내역 조회, **Then** 최근 거래 목록과 총 수익률이 표시됩니다.

---

### User Story 6 - 백테스팅을 통한 전략 검증 (Priority: P2)

트레이더로서, 실제 자금 투입 전에 과거 데이터로 AI 전략의 성과를 시뮬레이션하여 검증할 수 있어야 합니다.

**Why this priority**: 백테스팅은 전략 신뢰성 검증에 중요하지만, 핵심 거래 기능이 먼저 완성되어야 합니다.

**Independent Test**: 6개월 과거 데이터로 백테스트를 실행하여 수익률, 최대 낙폭, 승률이 산출되는지 확인할 수 있습니다.

**Acceptance Scenarios**:

1. **Given** 6개월 이상의 과거 시장 데이터, **When** 백테스트 실행, **Then** 시스템이 총 수익률, 최대 낙폭(MDD), 승률, 손익비를 산출합니다.
2. **Given** 백테스트 완료, **When** 결과 조회, **Then** 시뮬레이션된 거래 내역과 성과 지표가 표시됩니다.
3. **Given** 백테스트 결과, **When** 저장 요청, **Then** 결과가 향후 비교 분석을 위해 저장됩니다.

---

### Edge Cases

- 네트워크 연결 끊김 중 매매 신호 발생 시 어떻게 처리되는가?
  - 시스템은 연결 복구 시까지 주문 실행을 보류하고, 신호 유효성을 재검증합니다.
- Upbit API 점검 시간 동안 시스템 동작은?
  - 시스템은 API 불가 상태를 감지하고, 점검 종료까지 대기 모드로 전환합니다.
- AI API 응답 지연 또는 실패 시 어떻게 대응하는가?
  - 5초 타임아웃 후 재시도하며, 3회 실패 시 해당 신호 주기를 건너뜁니다.
- 급격한 가격 변동(Flash Crash) 시 리스크 관리는?
  - 변동성 감지 시 추가 안전장치가 발동하여 거래를 일시 중단합니다.
- 잔고 부족 시 주문 처리는?
  - 주문 전 잔고 확인을 수행하고, 부족 시 주문을 거부하며 알림을 전송합니다.

## Requirements *(mandatory)*

### Functional Requirements

#### 데이터 수집

- **FR-001**: 시스템은 Upbit에서 비트코인 실시간 가격, 거래량, 체결 정보를 수집할 수 있어야 합니다.
- **FR-002**: 시스템은 설정 가능한 주기(기본 1초)로 데이터를 수집해야 합니다.
- **FR-003**: 시스템은 수집된 데이터를 향후 백테스팅을 위해 영구 저장해야 합니다.
- **FR-004**: 시스템은 데이터 수집 실패 시 자동으로 재연결을 시도해야 합니다.

#### AI 신호 생성

- **FR-005**: 시스템은 수집된 시장 데이터를 AI 분석을 위해 정제해야 합니다.
- **FR-006**: 시스템은 AI를 통해 매매 신호(Buy/Hold/Sell)와 신뢰도 점수(0~1)를 생성해야 합니다.
- **FR-007**: 시스템은 AI 신호와 분석 근거를 기록해야 합니다.
- **FR-008**: 시스템은 AI 응답을 5초 이내에 수신해야 합니다.

#### 주문 실행

- **FR-009**: 시스템은 AI 신호에 따라 Upbit에서 시장가/지정가 주문을 실행해야 합니다.
- **FR-010**: 시스템은 주문 실패 시 자동으로 재시도해야 합니다.
- **FR-011**: 시스템은 모든 주문과 체결 정보를 기록해야 합니다.
- **FR-012**: 시스템은 주문 실행 전 리스크 규칙을 검증해야 합니다.

#### 리스크 관리

- **FR-013**: 시스템은 개별 주문 금액을 전체 자본의 1~2%로 제한해야 합니다.
- **FR-014**: 시스템은 개별 거래 손실이 3~5%에 도달하면 자동으로 손절해야 합니다.
- **FR-015**: 시스템은 일일 손실 한도 초과 시 자동으로 거래를 중단해야 합니다.
- **FR-016**: 시스템은 급격한 가격 변동 감지 시 추가 안전장치를 발동해야 합니다.
- **FR-017**: 시스템은 리스크 이벤트 발생 시 관리자에게 알림을 전송해야 합니다.

#### 백테스팅

- **FR-018**: 시스템은 최소 6개월~1년의 과거 데이터로 전략을 시뮬레이션할 수 있어야 합니다.
- **FR-019**: 시스템은 백테스트 결과로 총 수익률, 최대 낙폭, 승률, 손익비를 산출해야 합니다.
- **FR-020**: 시스템은 백테스트 결과를 저장하고 비교 분석할 수 있어야 합니다.

#### 대시보드

- **FR-021**: 시스템은 현재 비트코인 가격, 포지션, 계좌 잔고를 표시하는 웹 대시보드를 제공해야 합니다.
- **FR-022**: 시스템은 대시보드에서 거래 내역과 수익률을 조회할 수 있어야 합니다.
- **FR-023**: 시스템은 대시보드 정보를 실시간으로 업데이트해야 합니다.

#### 보안 및 로깅

- **FR-024**: 시스템은 API 키를 안전하게 저장해야 합니다(환경 변수 또는 암호화).
- **FR-025**: 시스템은 모든 주요 이벤트를 로그로 기록해야 합니다.
- **FR-026**: 시스템은 로그에서 민감 정보를 마스킹해야 합니다.
- **FR-027**: 시스템은 주문 실행 전 이중 검증을 수행해야 합니다.

### Key Entities

- **Market Data (시장 데이터)**: 비트코인 가격, 거래량, 체결 정보를 포함하는 시계열 데이터. 실시간 분석과 백테스팅의 기반.
- **Trading Signal (매매 신호)**: AI가 생성한 매매 결정(Buy/Hold/Sell), 신뢰도 점수, 분석 근거를 포함.
- **Order (주문)**: 매매 신호에 따른 실제 거래 주문. 주문 유형, 금액, 상태, 체결 정보 포함.
- **Backtest Result (백테스트 결과)**: 과거 데이터 기반 전략 시뮬레이션 결과. 수익률, MDD, 승률 등 성과 지표 포함.
- **Risk Event (리스크 이벤트)**: 손절, 시스템 정지 등 리스크 관리 발동 기록.

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 시스템이 24시간 연속 운영되며, 가용성 99.5% 이상을 유지합니다.
- **SC-002**: AI 신호 생성부터 주문 체결까지 10초 이내에 완료됩니다.
- **SC-003**: 리스크 규칙(손절, 포지션 제한)이 100% 정확하게 적용됩니다.
- **SC-004**: 시스템이 네트워크 장애 발생 후 60초 이내에 자동 복구됩니다.
- **SC-005**: 백테스트 시뮬레이션이 6개월 데이터 기준 10분 이내에 완료됩니다.
- **SC-006**: 대시보드에서 거래 정보가 5초 이내에 실시간 반영됩니다.
- **SC-007**: 모든 거래와 신호가 100% 기록되어 추적 가능합니다.
- **SC-008**: 사용자가 대시보드에서 현재 상태와 수익률을 즉시 확인할 수 있습니다.

## Assumptions

- Upbit 거래소 API가 안정적으로 운영되며 문서화된 대로 동작합니다.
- 사용자는 유효한 Upbit API 키와 거래 권한을 보유하고 있습니다.
- 사용자는 유효한 AI API 키를 보유하고 있습니다.
- 시스템은 단일 사용자(트레이더)가 개인적으로 사용합니다.
- 비트코인(BTC/KRW) 마켓만 대상으로 합니다.
- 리스크 파라미터(손절 비율, 포지션 크기 등)는 시스템 설정으로 구성됩니다.
- 인터넷 연결이 안정적으로 유지됩니다.

## Out of Scope

- 비트코인 외 다른 암호화폐 거래
- Upbit 외 다른 거래소 지원
- 다중 사용자 지원 및 사용자 인증
- 모바일 애플리케이션
- 알고리즘 트레이딩 전략 자체 개발 (AI에 위임)
- 세금 보고서 생성
- 실시간 푸시 알림 (이메일/SMS)
